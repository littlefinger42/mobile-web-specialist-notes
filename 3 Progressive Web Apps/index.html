<!doctype html>
<html lang="en">
	<head>
		<!-- Meta Tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		<title>3 - Progressive Web Apps</title>
		
		<!-- Styling -->
		<link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
		<style>
		pre code {
			color: #e83e8c;
		}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>Progressive Web Apps</h1>
			
			<div id="accordian">
				<div class="card">
					<div class="card-header" id="serviceWorkersHeader">
						<h5 class="mb-0">
							<button class="btn btn-link" data-toggle="collapse" data-target="#serviceWorkers" aria-expanded="false" aria-controls="serviceWorkers">
								Service Workers
							</button>
						</h5>
					</div>
					<div id="serviceWorkers" class="collapse" aria-labelledby="serviceWorkersHeader" data-parent="#accordion">
						<div class="card-body">
							<div class="container-fluid">
								<div class="row">
									<div class="col-sm">
                                        <h3>Requirements</h3>
                                        <ol>
                                            <li>HTTPs or localhost</li>
                                            <li>The browser supports it</li>
                                        </ol>
                                        <h3>Basic Architecture</h3>
                                        <ol>
                                            <li>The service worker is registered via <code>serviceWorkerContainer.register()</code></li>
                                            <li>If successfull, it is registered in a <code>ServiceWorkerGlobalScope</code>. This is a context just for the service worker and has no access to the DOM.</li>
                                            <li>Installation of the service worker is only done when service worker pages are accessed. An install event is the first one sent to the service worker. When the <code>oninstall</code> handler completes, the service worker is installed.</li>
                                            <li>After installation, it recieves an activate event. The primary use for <code>onactivate</code> is for cleanup of resources in previous version of the service worker.</li>
                                        </ol>
                                        <img src="images/sw-lifecycle.png" alt="Service worker lifecycle"/>
                                        <img src="images/sw-events.png" alt="Service worker events"/>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="card">
					<div class="card-header" id="corsHeader">
						<h5 class="mb-0">
							<button class="btn btn-link" data-toggle="collapse" data-target="#cors" aria-expanded="false" aria-controls="cors">
								CORS
							</button>
						</h5>
					</div>
					<div id="cors" class="collapse" aria-labelledby="corsHeader" data-parent="#accordion">
						<div class="card-body">
							<div class="container-fluid">
								<div class="row">
									<div class="col-sm">
										<h3>What</h3>
										<p>CORS allows a user to access selected resources from a server on a different origin that the site currently in use by using request headers. The user makes a cross-origin HTTP request.</p>
										<p>For security reasons, browsers restrict cross-origin HTTP requests initiated from within scripts. For example, the XMLHttpRequest and the Fetch API follow the same-origin policy. This means that the scripts can only make requests to the same domain that the site is hosted on.</p>
										<h3>Where</h3>
										<ul>
											<li>XMLHttpRequest / Fetch</li>
											<li>Webfonts</li>
											<li>WebGL textures</li>
											<li>Images &amp; video frames drawn using drawImage on a canvas</li>
											<li>Stylesheets</li>
											<li>Scripts</li>
										</ul>
										<h3>How</h3>
										<p>CORS works by adding new HTTP headers that allow servers to describe the set of origins that are permitted to read information. Browsers are required to 'preflight' their requests using the OPTIONS request method, then upon approval from the server, send the actual request. Servers can also notify clients whether credentials are required with requests.</p>
										<h3>Exceptions (simple requests)</h3>
										<p>Some requests dont trigger CORS preflight. These are called <strong>simple requests</strong>. To be simple, you must meet the conditions:</p>
										<ul>
											<li>Either GET, HEAD or POST</li>
											<li>Only headers allowed: Accept, Accept-language, Content-language, Content-type (x-www-form-urlencoded, form-data, text/plain), Last-Event-id, DPR, Save-Date, Viewport-Width, Width</li>
											<li>No ReadableStream object is used in the request</li>
										</ul>
										<p>Read more about CORS on <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" title="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">MDN</a>.</p>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script>
			(function() {
				//Simplest Json fetching
				fetch('stufftofetch/movies.json').then(function(response) {
					return response.json();
				}).then(function(myJson) {
					console.log('Simple fetching JSON:', JSON.stringify(myJson));
				  });

				//Checking to see if a fetch was successful
				fetch('stufftofetch/movies.json').then(response => {
					if (response.ok) {
						return response.json();
					}
					throw new Error('Network response was not ok.');
				}).then(myJson => { 
					console.log('Checking if fetch successful fetching JSON:', JSON.stringify(myJson));
				}).catch(error => {
					console.log('There has been a problem with your fetch operation: ', error.message);
				});

				//Checking fetch status
				var fetchStatus;
				fetch('stufftofetch/movies.json').then(response => {
					fetchStatus = response.status;
					if (response.status === 200) {
						return response.json();
					}
					throw new Error('Network response was not ok.');
				}).then(myJson => { 
					console.log('Checking if fetch status is 200:', fetchStatus, JSON.stringify(myJson));
				}).catch(error => {
					console.log('There has been a problem with your fetch operation: ', fetchStatus, error.message);
				});
				  
				//Simplest Image fetching
				fetch('stufftofetch/flowers.jpg').then(function(response) {
					return response.blob()
				}).then(function(myBlob) {
					// var objectUrl = URL.createObjectUrl(myBlob);
					// var myImage = document.querySelector('#myImage');
					// myImage.src = objectUrl;
				});

				//Fetch error handling (chaining)
				fetch('stufftofetch/movies.json').then(response => {
					if (response.ok) {
						return response;
					}
					throw new Error('Network response was not ok.');
				}).then(response => {
					return response.json()
				}).then(myJson => {
					console.log('Fetch error handling (chaining):', JSON.stringify(myJson));
				}).catch(error => {
					console.log('There has been a problem with your fetch operation: ', error.message);
				});
			}())
		</script>

		<!-- Scripts -->
		<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
	</body>
</html>